<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Chat</title>
    <link rel="stylesheet" href="${styleUri}">
</head>
<body>
    <div id="session-status">
        <span id="status-indicator">‚ö™</span>
        <span id="status-text">Click "New Session" to start</span>
    </div>
    <div id="terminal"></div>
    <div id="input-area">
        <input type="text" id="message-input" placeholder="Type your message...">
        <button id="send-button">Send</button>
        <button id="new-session-button">New Session</button>
    </div>
    
    <script>
        const vscode = acquireVsCodeApi();
        
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const newSessionButton = document.getElementById('new-session-button');
        const terminal = document.getElementById('terminal');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Å—Å–∏–∏
        function updateSessionStatus(status, text) {
            statusIndicator.textContent = status;
            statusText.textContent = text;
        }
        
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ
                const userDiv = document.createElement('div');
                userDiv.className = 'message user-message';
                userDiv.textContent = 'You: ' + message;
                terminal.appendChild(userDiv);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                updateSessionStatus('üü°', 'Sending message...');
                
                vscode.postMessage({ type: 'sendMessage', text: message });
                messageInput.value = '';
                terminal.scrollTop = terminal.scrollHeight;
            }
        }
        
        function startNewSession() {
            // –û—á–∏—â–∞–µ–º —á–∞—Ç
            terminal.innerHTML = '';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateSessionStatus('üîÑ', 'Starting new session...');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
            const sessionDiv = document.createElement('div');
            sessionDiv.className = 'message session-message';
            sessionDiv.textContent = 'üîÑ Starting new session...';
            terminal.appendChild(sessionDiv);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
            vscode.postMessage({ type: 'newSession' });
            
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        sendButton.addEventListener('click', sendMessage);
        newSessionButton.addEventListener('click', startNewSession);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        window.addEventListener('message', event => {
            const message = event.data;
            if (message.type === 'claudeOutput') {
                const outputDiv = document.createElement('div');
                outputDiv.className = 'message claude-message';
                outputDiv.textContent = 'Claude: ' + message.text;
                terminal.appendChild(outputDiv);
                terminal.scrollTop = terminal.scrollHeight;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å - –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç
                updateSessionStatus('üü¢', 'Session active');
                
            } else if (message.type === 'sessionStatus') {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'message session-message';
                statusDiv.textContent = '‚úÖ ' + message.text;
                terminal.appendChild(statusDiv);
                terminal.scrollTop = terminal.scrollHeight;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å - —Å–µ—Å—Å–∏—è –≥–æ—Ç–æ–≤–∞
                updateSessionStatus('üü¢', 'Session active');
                
            } else if (message.type === 'sessionError') {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'message session-message';
                errorDiv.style.color = 'var(--vscode-errorForeground)';
                errorDiv.textContent = '‚ùå ' + message.text;
                terminal.appendChild(errorDiv);
                terminal.scrollTop = terminal.scrollHeight;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å - –æ—à–∏–±–∫–∞
                updateSessionStatus('üî¥', 'Session error');
            }
        });
    </script>
</body>
</html>